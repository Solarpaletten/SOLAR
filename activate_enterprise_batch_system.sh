#!/bin/bash
# ðŸš€ ÐÐšÐ¢Ð˜Ð’ÐÐ¦Ð˜Ð¯ ENTERPRISE BATCH SYSTEM

echo "ðŸŽŠðŸ”¥ðŸš€ ÐÐšÐ¢Ð˜Ð’Ð˜Ð Ð£Ð•Ðœ ENTERPRISE BATCH Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ£! ðŸš€ðŸ”¥ðŸŽŠ"
echo ""
echo "ðŸŽ¯ ÐŸÐ ÐžÐ‘Ð›Ð•ÐœÐ: Batch tracking Ð½Ðµ Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½ Ð² Purchases/Warehouse/Sales"
echo "ðŸ’¡ Ð Ð•Ð¨Ð•ÐÐ˜Ð•: ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð³Ð¾Ñ‚Ð¾Ð²ÑƒÑŽ Enterprise Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ñƒ"

echo ""
echo "1ï¸âƒ£ ÐŸÐ ÐžÐ’Ð•Ð Ð¯Ð•Ðœ Ð“ÐžÐ¢ÐžÐ’ÐÐžÐ¡Ð¢Ð¬ Ð¡Ð˜Ð¡Ð¢Ð•ÐœÐ«:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "ssh root@207.154.220.86"
echo "cd /var/www/ai/itsolar"

echo ""
echo "Ð) ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…:"
echo "ls -la prisma/migrations/ | grep batch"
echo "# Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ migration Ñ„Ð°Ð¹Ð»Ñ‹ Ñ batch tables"

echo ""
echo "Ð‘) ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Backend ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ñ‹:"
echo "find b/src -name '*batch*' -type f"
echo "grep -r 'product_batches' b/src/controllers/"
echo "grep -r 'batch_movements' b/src/controllers/"

echo ""
echo "2ï¸âƒ£ ÐÐšÐ¢Ð˜Ð’Ð˜Ð Ð£Ð•Ðœ BATCH CREATION Ð’ PURCHASES:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

echo ""
echo "Ð’ Ñ„Ð°Ð¹Ð»Ðµ: b/src/controllers/company/purchasesController.js"
echo "ÐÐ°Ð¹Ñ‚Ð¸ ÑÑ‚Ñ€Ð¾ÐºÑƒ: // 3. ÐÐ’Ð¢ÐžÐžÐ‘ÐÐžÐ’Ð›Ð•ÐÐ˜Ð• Ð¡ÐšÐ›ÐÐ”Ð"
echo "Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ Ð½Ð°:"
echo ""
echo "        // 3. Ð¡ÐžÐ—Ð”ÐÐÐ˜Ð• ÐŸÐÐ Ð¢Ð˜Ð™ (BATCH SYSTEM)"
echo "        for (const item of processedItems) {"
echo "          try {"
echo "            // Ð¡Ð¾Ð·Ð´Ð°Ñ‘Ð¼ Ð¿Ð°Ñ€Ñ‚Ð¸ÑŽ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð¹ Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¸ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸"
echo "            const batch = await tx.product_batches.create({"
echo "              data: {"
echo "                company_id: companyId,"
echo "                batch_number: \`BATCH-\${purchase.id}-\${item.product_id}\`,"
echo "                product_id: item.product_id,"
echo "                warehouse_id: warehouse_id,"
echo "                supplier_id: parseInt(supplier_id),"
echo "                original_quantity: item.quantity,"
echo "                current_quantity: item.quantity,"
echo "                unit_cost: item.unit_price_base,"
echo "                purchase_date: new Date(document_date),"
echo "                status: 'ACTIVE',"
echo "                created_by: userId"
echo "              }"
echo "            });"
echo ""
echo "            // Ð—Ð°Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ð´Ð²Ð¸Ð¶ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ñ‚Ð¸Ð¸"
echo "            await tx.batch_movements.create({"
echo "              data: {"
echo "                company_id: companyId,"
echo "                batch_id: batch.id,"
echo "                product_id: item.product_id,"
echo "                warehouse_id: warehouse_id,"
echo "                purchase_id: purchase.id,"
echo "                movement_type: 'IN',"
echo "                quantity: item.quantity,"
echo "                unit_cost: item.unit_price_base,"
echo "                description: \`Purchase \${document_number} - batch creation\`,"
echo "                reference_document: document_number,"
echo "                movement_date: new Date(document_date),"
echo "                created_by: userId"
echo "              }"
echo "            });"
echo ""
echo "            logger.info(\`ðŸ“¦ BATCH: Created batch \${batch.batch_number} for product \${item.product_id}\`);"
echo "          } catch (batchError) {"
echo "            logger.error(\`âŒ Error creating batch:\`, batchError);"
echo "          }"
echo "        }"

echo ""
echo "3ï¸âƒ£ Ð¡ÐžÐ—Ð”ÐÐÐœ WAREHOUSE INVENTORY API:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

echo ""
echo "Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ„Ð°Ð¹Ð»: b/src/controllers/company/inventoryController.js"
echo ""
echo "const getWarehouseInventory = async (req, res) => {"
echo "  try {"
echo "    const companyId = req.companyContext?.companyId;"
echo "    const { warehouseId } = req.params;"
echo ""
echo "    const inventory = await prisma.product_batches.findMany({"
echo "      where: {"
echo "        company_id: companyId,"
echo "        warehouse_id: parseInt(warehouseId),"
echo "        current_quantity: { gt: 0 },"
echo "        status: 'ACTIVE'"
echo "      },"
echo "      include: {"
echo "        product: { select: { name: true, code: true, unit: true } },"
echo "        supplier: { select: { name: true } }"
echo "      },"
echo "      orderBy: { purchase_date: 'asc' }"
echo "    });"
echo ""
echo "    const summary = await prisma.\$queryRaw\`"
echo "      SELECT "
echo "        p.id as product_id,"
echo "        p.name,"
echo "        p.code,"
echo "        p.unit,"
echo "        SUM(pb.current_quantity) as total_stock,"
echo "        AVG(pb.unit_cost) as avg_cost,"
echo "        COUNT(pb.id) as batch_count"
echo "      FROM product_batches pb"
echo "      JOIN products p ON pb.product_id = p.id"
echo "      WHERE pb.company_id = \${companyId}"
echo "        AND pb.warehouse_id = \${parseInt(warehouseId)}"
echo "        AND pb.current_quantity > 0"
echo "        AND pb.status = 'ACTIVE'"
echo "      GROUP BY p.id, p.name, p.code, p.unit"
echo "      ORDER BY p.name"
echo "    \`;"
echo ""
echo "    res.json({"
echo "      success: true,"
echo "      inventory: {"
echo "        batches: inventory,"
echo "        summary: summary"
echo "      }"
echo "    });"
echo "  } catch (error) {"
echo "    res.status(500).json({ success: false, error: error.message });"
echo "  }"
echo "};"

echo ""
echo "4ï¸âƒ£ Ð”ÐžÐ‘ÐÐ’Ð›Ð¯Ð•Ðœ ÐœÐÐ Ð¨Ð Ð£Ð¢Ð«:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

echo ""
echo "Ð’ Ñ„Ð°Ð¹Ð»: b/src/routes/company/index.js Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ:"
echo ""
echo "// Inventory & Batches"
echo "router.get('/warehouses/:warehouseId/inventory', inventoryController.getWarehouseInventory);"
echo "router.get('/batches/product/:productId', batchController.getProductBatches);"
echo "router.post('/batches/allocate', batchController.allocateBatches);"

echo ""
echo "5ï¸âƒ£ ÐžÐ‘ÐÐžÐ’Ð›Ð¯Ð•Ðœ FRONTEND WAREHOUSE:"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

echo ""
echo "Ð’ Ñ„Ð°Ð¹Ð»Ðµ: f/src/pages/company/warehouse/WarehouseManagement.tsx"
echo "Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ Ð¸Ð½Ð²ÐµÐ½Ñ‚Ð°Ñ€Ñ:"
echo ""
echo "const InventoryTable = ({ warehouseId }) => {"
echo "  const [inventory, setInventory] = useState([]);"
echo ""
echo "  useEffect(() => {"
echo "    fetchInventory();"
echo "  }, [warehouseId]);"
echo "