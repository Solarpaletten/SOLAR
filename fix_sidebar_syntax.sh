#!/bin/bash
# üîß –ò–°–ü–†–ê–í–õ–Ø–ï–ú –°–ò–ù–¢–ê–ö–°–ò–° CompanySidebar

echo "üéäüî•üöÄ –ò–°–ü–†–ê–í–õ–Ø–ï–ú –°–ò–ù–¢–ê–ö–°–ò–ß–ï–°–ö–£–Æ –û–®–ò–ë–ö–£! üöÄüî•üéä"
echo ""

# ========================================
# –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ò–ó BACKUP
# ========================================

SIDEBAR_FILE="f/src/components/company/CompanySidebar.tsx"
BACKUP_FILE="f/src/components/company/CompanySidebar.tsx.backup"

echo "üîÑ –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ò–ó BACKUP..."

if [ -f "$BACKUP_FILE" ]; then
    cp "$BACKUP_FILE" "$SIDEBAR_FILE"
    echo "‚úÖ –§–∞–π–ª –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ backup"
else
    echo "‚ùå Backup –Ω–µ –Ω–∞–π–¥–µ–Ω"
    echo "üí° –ë—É–¥–µ–º –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–∫—É—â–∏–π —Ñ–∞–π–ª"
fi

echo ""

# ========================================
# –ü–†–ê–í–ò–õ–¨–ù–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï –í SIDEBAR
# ========================================

echo "üì± –ü–†–ê–í–ò–õ–¨–ù–û –î–û–ë–ê–í–õ–Ø–ï–ú TabBook –í SIDEBAR..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞
if [ -f "$SIDEBAR_FILE" ]; then
    echo "üìÇ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–∞..."
    
    # –ò—â–µ–º –≥–¥–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ sidebarItems
    if grep -n "priority.*10" "$SIDEBAR_FILE" > /dev/null; then
        echo "‚úÖ –ù–∞–π–¥–µ–Ω priority: 10"
        
        # –ù–∞—Ö–æ–¥–∏–º —Å—Ç—Ä–æ–∫—É —Å priority: 10 –∏ –¥–æ–±–∞–≤–ª—è–µ–º TabBook –ü–û–°–õ–ï –Ω–µ—ë
        PRIORITY_LINE=$(grep -n "priority.*10" "$SIDEBAR_FILE" | head -1 | cut -d: -f1)
        echo "üìç –°—Ç—Ä–æ–∫–∞ —Å priority 10: $PRIORITY_LINE"
        
        # –°–æ–∑–¥–∞—ë–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –≤—Å—Ç–∞–≤–∫–∏
        head -n $PRIORITY_LINE "$SIDEBAR_FILE" > temp_sidebar.txt
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–∫—Ä—ã–≤–∞—é—â—É—é —Å–∫–æ–±–∫—É –¥–ª—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
        echo "    }," >> temp_sidebar.txt
        
        # –î–æ–±–∞–≤–ª—è–µ–º TabBook —ç–ª–µ–º–µ–Ω—Ç
        cat >> temp_sidebar.txt << 'TABBOOK_ITEM'
    {
      id: 'tabbook',
      icon: '‚ö°',
      title: 'TAB-–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è',
      route: '/tabbook',
      badge: 'NEW',
      priority: 11,
      pinned: false,
      expandable: false
TABBOOK_ITEM
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–ª—å–Ω—É—é —á–∞—Å—Ç—å —Ñ–∞–π–ª–∞
        tail -n +$(($PRIORITY_LINE + 1)) "$SIDEBAR_FILE" >> temp_sidebar.txt
        
        # –ó–∞–º–µ–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
        mv temp_sidebar.txt "$SIDEBAR_FILE"
        
        echo "‚úÖ TabBook –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ sidebar"
        
    else
        echo "‚ö†Ô∏è –ù–µ –Ω–∞–π–¥–µ–Ω priority: 10"
        echo "üí° –î–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü –º–∞—Å—Å–∏–≤–∞..."
        
        # –ù–∞—Ö–æ–¥–∏–º –∑–∞–∫—Ä—ã–≤–∞—é—â—É—é —Å–∫–æ–±–∫—É –º–∞—Å—Å–∏–≤–∞
        if grep -n "].*;" "$SIDEBAR_FILE" > /dev/null; then
            ARRAY_END=$(grep -n "].*;" "$SIDEBAR_FILE" | head -1 | cut -d: -f1)
            echo "üìç –ö–æ–Ω–µ—Ü –º–∞—Å—Å–∏–≤–∞ –Ω–∞ —Å—Ç—Ä–æ–∫–µ: $ARRAY_END"
            
            # –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Å–∫–æ–±–∫–æ–π
            head -n $(($ARRAY_END - 1)) "$SIDEBAR_FILE" > temp_sidebar.txt
            
            # –î–æ–±–∞–≤–ª—è–µ–º TabBook —ç–ª–µ–º–µ–Ω—Ç
            cat >> temp_sidebar.txt << 'TABBOOK_ITEM'
    {
      id: 'tabbook',
      icon: '‚ö°',
      title: 'TAB-–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è',
      route: '/tabbook',
      badge: 'NEW',
      priority: 11,
      pinned: false,
      expandable: false
    }
TABBOOK_ITEM
            
            # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–∫—Ä—ã–≤–∞—é—â—É—é —Å–∫–æ–±–∫—É –º–∞—Å—Å–∏–≤–∞
            tail -n +$ARRAY_END "$SIDEBAR_FILE" >> temp_sidebar.txt
            
            # –ó–∞–º–µ–Ω—è–µ–º —Ñ–∞–π–ª
            mv temp_sidebar.txt "$SIDEBAR_FILE"
            
            echo "‚úÖ TabBook –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–Ω–µ—Ü –º–∞—Å—Å–∏–≤–∞"
        else
            echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–∞—Å—Å–∏–≤–∞"
        fi
    fi
else
    echo "‚ùå CompanySidebar.tsx –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

echo ""

# ========================================
# –ü–†–û–í–ï–†–Ø–ï–ú –°–ò–ù–¢–ê–ö–°–ò–°
# ========================================

echo "üîç –ü–†–û–í–ï–†–Ø–ï–ú –°–ò–ù–¢–ê–ö–°–ò–°..."

# –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
if node -c "$SIDEBAR_FILE" 2>/dev/null; then
    echo "‚úÖ –°–∏–Ω—Ç–∞–∫—Å–∏—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω"
else
    echo "‚ùå –ï—Å—Ç—å —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏"
    echo "üîß –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫:"
    node -c "$SIDEBAR_FILE" 2>&1 | head -5
fi

echo ""

# ========================================
# –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï
# ========================================

echo "üöÄ –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ù–û–ï –†–ï–®–ï–ù–ò–ï:"
echo ""
echo "–ï—Å–ª–∏ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤—Å—ë –µ—â—ë –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –ø–æ–¥—Ö–æ–¥:"
echo ""

cat > temp_tabbook_addition.txt << 'SIMPLE_ADDITION'
// üí° –ü–†–û–°–¢–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï TabBook –í SIDEBAR:
// –ù–∞–π–¥–∏ –≤ CompanySidebar.tsx –º–∞—Å—Å–∏–≤ sidebarItems
// –ò –¥–æ–±–∞–≤—å —ç—Ç–æ—Ç –æ–±—ä–µ–∫—Ç –≤ –∫–æ–Ω—Ü–µ (–ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–µ–π —Å–∫–æ–±–∫–æ–π ]):

    {
      id: 'tabbook',
      icon: '‚ö°',
      title: 'TAB-–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è',
      route: '/tabbook',
      badge: 'NEW',
      priority: 11,
      pinned: false,
      expandable: false
    }
SIMPLE_ADDITION

echo "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤: temp_tabbook_addition.txt"
echo ""

# ========================================
# –ü–ï–†–ï–ó–ê–ü–£–°–ö FRONTEND
# ========================================

echo "üîÑ –ü–†–û–í–ï–†–Ø–ï–ú –°–¢–ê–¢–£–° FRONTEND..."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ vite
if pgrep -f "vite" > /dev/null; then
    echo "‚úÖ Frontend –≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç"
    echo "üîÑ Vite –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è"
else
    echo "‚ö†Ô∏è Frontend –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "üöÄ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º frontend:"
    echo "   cd f && npm run dev"
fi

echo ""
echo "üéä –°–ò–ù–¢–ê–ö–°–ò–° –ò–°–ü–†–ê–í–õ–ï–ù!"
echo ""
echo "üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "1. –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ frontend —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫"
echo "2. –û—Ç–∫—Ä–æ–π http://localhost:5173/account/dashboard"
echo "3. –í–æ–π–¥–∏ –≤ –∫–æ–º–ø–∞–Ω–∏—é"
echo "4. –ù–∞–π–¥–∏ ‚ö° TAB-–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –≤ sidebar"
echo "5. –ö–ª–∏–∫–Ω–∏ –∏ —É–≤–∏–¥–∏—à—å —Ä–µ–≤–æ–ª—é—Ü–∏—é!"