// ===============================================
// üèóÔ∏è SOLAR ERP - –§–ò–ù–ê–õ–¨–ù–ê–Ø –î–í–£–•–£–†–û–í–ù–ï–í–ê–Ø PRISMA –°–•–ï–ú–ê
// ===============================================
// üéØ 100% —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å B1.lt + —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
// üè¢ Account Level: –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏
// üè≠ Company Level: –ë–∏–∑–Ω–µ—Å-–æ–ø–µ—Ä–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–π
// ÔøΩÔøΩ –ì–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!
// ===============================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===============================================
// üìä ENUMS
// ===============================================

enum UserRole {
  ADMIN              // –°–∏—Å—Ç–µ–º–Ω—ã–π –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
  USER               // –û–±—ã—á–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
}

enum CompanyUserRole {
  OWNER              // –í–ª–∞–¥–µ–ª–µ—Ü –∫–æ–º–ø–∞–Ω–∏–∏
  ADMIN              // –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–º–ø–∞–Ω–∏–∏
  MANAGER            // –ú–µ–Ω–µ–¥–∂–µ—Ä
  EMPLOYEE           // –°–æ—Ç—Ä—É–¥–Ω–∏–∫
  VIEWER             // –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä
}

enum ClientRole {
  CLIENT             // –ö–ª–∏–µ–Ω—Ç
  SUPPLIER           // –ü–æ—Å—Ç–∞–≤—â–∏–∫
  BOTH               // –ò –∫–ª–∏–µ–Ω—Ç –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫
}

enum Currency {
  EUR
  USD
  AED
  UAH
  GBP
}

enum DocumentStatus {
  DRAFT              // –ß–µ—Ä–Ω–æ–≤–∏–∫
  PENDING            // –í –æ–∂–∏–¥–∞–Ω–∏–∏
  APPROVED           // –£—Ç–≤–µ—Ä–∂–¥–µ–Ω
  COMPLETED          // –ó–∞–≤–µ—Ä—à–µ–Ω
  CANCELLED          // –û—Ç–º–µ–Ω–µ–Ω
}

enum PaymentStatus {
  PENDING            // –û–∂–∏–¥–∞–µ—Ç –æ–ø–ª–∞—Ç—É
  PARTIAL            // –ß–∞—Å—Ç–∏—á–Ω–æ –æ–ø–ª–∞—á–µ–Ω–æ
  PAID               // –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø–ª–∞—á–µ–Ω–æ
  OVERDUE            // –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–æ
  CANCELLED          // –û—Ç–º–µ–Ω–µ–Ω–æ
}

enum DeliveryStatus {
  PENDING            // –û–∂–∏–¥–∞–µ—Ç –æ—Ç–≥—Ä—É–∑–∫—É
  PARTIAL            // –ß–∞—Å—Ç–∏—á–Ω–æ –æ—Ç–≥—Ä—É–∂–µ–Ω–æ
  DELIVERED          // –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
  IN_TRANSIT         // –í –ø—É—Ç–∏
  CANCELLED          // –û—Ç–º–µ–Ω–µ–Ω–æ
}

enum SalesDocumentType {
  QUOTE              // –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
  ORDER              // –ó–∞–∫–∞–∑
  INVOICE            // –°—á–µ—Ç-—Ñ–∞–∫—Ç—É—Ä–∞
  DELIVERY_NOTE      // –ù–∞–∫–ª–∞–¥–Ω–∞—è
  RECEIPT            // –ö–≤–∏—Ç–∞–Ω—Ü–∏—è
}

enum PurchaseOperationType {
  PURCHASE           // –ó–∞–∫—É–ø–∫–∞
  RETURN             // –í–æ–∑–≤—Ä–∞—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫—É
  CORRECTION         // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞
  TRANSFER           // –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ
}

enum WarehouseStatus {
  ACTIVE
  INACTIVE
  MAINTENANCE
}

enum BankOperationType {
  INCOME             // –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ
  EXPENSE            // –†–∞—Å—Ö–æ–¥
  TRANSFER           // –ü–µ—Ä–µ–≤–æ–¥
}

// ===============================================
// üè¢ ACCOUNT LEVEL MODELS
// –°–∏—Å—Ç–µ–º–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ - –ë–ï–ó company_id
// ===============================================

model users {
  id                    Int      @id @default(autoincrement())
  
  // ===============================================
  // üìã –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  username              String   @unique @db.VarChar(50)
  email                 String   @unique @db.VarChar(100)
  password_hash         String   @db.VarChar(255)
  
  // ===============================================
  // üë§ –ü–ï–†–°–û–ù–ê–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  first_name            String?  @db.VarChar(50)
  last_name             String?  @db.VarChar(50)
  phone                 String?  @db.VarChar(20)
  
  // ===============================================
  // üîß –°–ò–°–¢–ï–ú–ù–´–ï –ü–û–õ–Ø
  // ===============================================
  role                  UserRole @default(USER)
  status                String   @default("active") @db.VarChar(20)
  is_active             Boolean  @default(true)
  
  // ===============================================
  // ‚úâÔ∏è EMAIL –í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø
  // ===============================================
  email_verified        Boolean  @default(false)
  email_verified_at     DateTime?
  verification_token    String?  @unique @db.VarChar(255)
  
  // ===============================================
  // üîê –°–ë–†–û–° –ü–ê–†–û–õ–Ø
  // ===============================================
  reset_token           String?  @unique @db.VarChar(255)
  reset_token_expires   DateTime?
  
  // ===============================================
  // üéØ –û–ù–ë–û–†–î–ò–ù–ì –ò –ö–û–ù–¢–ï–ö–°–¢
  // ===============================================
  onboarding_completed  Boolean  @default(false)
  current_company_id    Int?     // –¢–µ–∫—É—â–∞—è –∞–∫—Ç–∏–≤–Ω–∞—è –∫–æ–º–ø–∞–Ω–∏—è
  
  // ===============================================
  // ‚è∞ –í–†–ï–ú–ï–ù–ù–´–ï –ú–ï–¢–ö–ò
  // ===============================================
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
  last_login_at         DateTime?
  
  // ===============================================
  // üîó –°–í–Ø–ó–ò
  // ===============================================
  
  // Account Level —Å–≤—è–∑–∏
  owned_companies       companies[]           @relation("CompanyOwner")
  company_memberships   company_users[]
  
  // Company Level —Å–≤—è–∑–∏ (—Å company_id)
  created_clients       clients[]             @relation("ClientCreator")
  created_products      products[]            @relation("ProductCreator")
  created_sales         sales[]               @relation("SaleCreator")
  modified_sales        sales[]               @relation("SaleModifier")
  managed_sales         sales[]               @relation("SalesManager")
  created_purchases     purchases[]           @relation("PurchaseCreator")
  modified_purchases    purchases[]           @relation("PurchaseModifier")
  managed_purchases     purchases[]           @relation("PurchaseManager")
  created_warehouses    warehouses[]          @relation("WarehouseCreator")
  responsible_warehouses warehouses[]         @relation("WarehouseResponsible")
  bank_operations       bank_operations[]
  chart_of_accounts     chart_of_accounts[]
  address_responsibilities client_addresses[] @relation("AddressEmployee")
  purchase_item_responsibilities purchase_items[] @relation("PurchaseItemEmployee")
  
  @@index([email])
  @@index([username])
  @@index([role])
  @@index([is_active])
  @@index([current_company_id])
}

model companies {
  id                    Int      @id @default(autoincrement())
  
  // ===============================================
  // üìã –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  code                  String   @unique @db.VarChar(20)
  name                  String   @db.VarChar(100)
  short_name            String?  @db.VarChar(50)
  description           String?  @db.Text
  
  // ===============================================
  // üìû –ö–û–ù–¢–ê–ö–¢–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  email                 String?  @db.VarChar(100)
  phone                 String?  @db.VarChar(20)
  website               String?  @db.VarChar(200)
  
  // ===============================================
  // üèõÔ∏è –Æ–†–ò–î–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  legal_entity_type     String   @db.VarChar(50)      // LLC, GMBH, Inc
  registration_number   String?  @db.VarChar(50)
  vat_number            String?  @db.VarChar(50)
  
  // ===============================================
  // üè† –ê–î–†–ï–°–ê
  // ===============================================
  legal_address         String?  @db.Text
  actual_address        String?  @db.Text
  
  // ===============================================
  // üí∞ –ù–ê–õ–û–ì–û–û–ë–õ–û–ñ–ï–ù–ò–ï –ò –í–ê–õ–Æ–¢–ê
  // ===============================================
  tax_country           String   @db.VarChar(3) @default("UAE")
  base_currency         Currency @default(AED)
  
  // ===============================================
  // üë• –í–õ–ê–î–ï–õ–ï–¶ –ò –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–´–ï
  // ===============================================
  owner_id              Int
  director_name         String   @db.VarChar(100)
  
  // ===============================================
  // ‚ö° –°–¢–ê–¢–£–°–´
  // ===============================================
  is_active             Boolean  @default(true)
  setup_completed       Boolean  @default(false)
  email_verified        Boolean  @default(false)
  
  // ===============================================
  // ‚è∞ –í–†–ï–ú–ï–ù–ù–´–ï –ú–ï–¢–ö–ò
  // ===============================================
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
  
  // ===============================================
  // üîó –°–í–Ø–ó–ò
  // ===============================================
  
  // Account Level —Å–≤—è–∑–∏
  owner                 users             @relation("CompanyOwner", fields: [owner_id], references: [id], onDelete: Restrict)
  employees             company_users[]
  
  // Company Level —Å–≤—è–∑–∏
  clients               clients[]
  products              products[]
  sales                 sales[]
  purchases             purchases[]
  warehouses            warehouses[]
  bank_operations       bank_operations[]
  chart_of_accounts     chart_of_accounts[]
  vat_classifications   vat_classifications[]
  cost_centers          cost_centers[]
  
  @@index([owner_id])
  @@index([code])
  @@index([name])
  @@index([is_active])
  @@index([tax_country])
}

// ===============================================
// ü§ù –°–í–Ø–ó–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô –° –ö–û–ú–ü–ê–ù–ò–Ø–ú–ò
// ===============================================

model company_users {
  id                    Int              @id @default(autoincrement())
  
  // ===============================================
  // üîó –°–í–Ø–ó–ò
  // ===============================================
  company_id            Int
  user_id               Int
  
  // ===============================================
  // üëî –†–û–õ–¨ –ò –ü–†–ê–í–ê
  // ===============================================
  role                  CompanyUserRole  @default(EMPLOYEE)
  permissions           String[]         @default([])  // JSON –º–∞—Å—Å–∏–≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
  
  // ===============================================
  // ‚ö° –°–¢–ê–¢–£–°
  // ===============================================
  is_active             Boolean          @default(true)
  
  // ===============================================
  // ‚è∞ –í–†–ï–ú–ï–ù–ù–´–ï –ú–ï–¢–ö–ò
  // ===============================================
  joined_at             DateTime         @default(now())
  updated_at            DateTime         @updatedAt
  
  // ===============================================
  // üîó –°–í–Ø–ó–ò
  // ===============================================
  company               companies        @relation(fields: [company_id], references: [id], onDelete: Cascade)
  user                  users            @relation(fields: [user_id], references: [id], onDelete: Cascade)
  
  @@unique([company_id, user_id])
  @@index([company_id])
  @@index([user_id])
  @@index([role])
}

// ===============================================
// üè≠ COMPANY LEVEL MODELS
// –ë–∏–∑–Ω–µ—Å-–¥–∞–Ω–Ω—ã–µ - –° –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ú company_id
// ===============================================

model clients {
  id                    Int         @id @default(autoincrement())
  company_id            Int         // üîë –ö–õ–Æ–ß –§–ò–õ–¨–¢–†–ê–¶–ò–ò!
  
  // ===============================================
  // üìã –û–°–ù–û–í–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  name                  String      @db.VarChar(200)
  abbreviation          String?     @db.VarChar(100)
  code                  String?     @db.VarChar(50)
  
  // ===============================================
  // üìû –ö–û–ù–¢–ê–ö–¢–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  email                 String      @db.VarChar(100)
  phone                 String?     @db.VarChar(20)
  fax                   String?     @db.VarChar(20)
  website               String?     @db.VarChar(200)
  contact_information   String?     @db.Text
  
  // ===============================================
  // üè¢ –¢–ò–ü–´ –ò –°–¢–ê–¢–£–°–´
  // ===============================================
  role                  ClientRole  @default(CLIENT)
  is_juridical          Boolean     @default(true)
  is_active             Boolean     @default(true)
  is_foreigner          Boolean     @default(false)
  
  // ===============================================
  // üåç –ì–ï–û–ì–†–ê–§–ò–ß–ï–°–ö–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  country               String?     @db.VarChar(100)
  legal_address         String?     @db.Text
  actual_address        String?     @db.Text
  
  // ===============================================
  // üíº –ù–ê–õ–û–ì–û–í–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  business_license_code String?     @db.VarChar(50)
  vat_code              String?     @db.VarChar(50)
  vat_rate              Decimal?    @db.Decimal(5, 2)
  eori_code             String?     @db.VarChar(50)
  foreign_taxpayer_code String?     @db.VarChar(50)
  registration_number   String?     @db.VarChar(50)
  
  // ===============================================
  // üí∞ –§–ò–ù–ê–ù–°–û–í–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  credit_sum            Decimal?    @db.Decimal(15, 2) @default(0)
  pay_per               String?     @db.VarChar(50)
  currency              Currency    @default(EUR)
  payment_terms         String?     @db.VarChar(100)
  automatic_debt_reminder Boolean?  @default(false)
  
  // ===============================================
  // üìÖ –í–ê–ñ–ù–´–ï –î–ê–¢–´
  // ===============================================
  registration_date     DateTime?   @db.Date
  date_of_birth         DateTime?   @db.Date
  
  // ===============================================
  // üîó –ò–ù–¢–ï–ì–†–ê–¶–ò–ò
  // ===============================================
  sabis_customer_name   String?     @db.VarChar(200)
  sabis_customer_code   String?     @db.VarChar(50)
  
  // ===============================================
  // üìù –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø
  // ===============================================
  additional_information String?    @db.Text
  notes                 String?     @db.Text
  
  // ===============================================
  // üîß –°–ò–°–¢–ï–ú–ù–´–ï –ü–û–õ–Ø
  // ===============================================
  created_by            Int
  created_at            DateTime    @default(now())
  updated_at            DateTime    @updatedAt
  
  // ===============================================
  // üîó –°–í–Ø–ó–ò
  // ===============================================
  company               companies   @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator               users       @relation("ClientCreator", fields: [created_by], references: [id])
  
  // –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏
  addresses             client_addresses[]
  bank_accounts         client_bank_accounts[]
  
  // –ë–∏–∑–Ω–µ—Å-—Å–≤—è–∑–∏
  sales                 sales[]
  purchases             purchases[]
  warehouses            warehouses[]
  bank_operations       bank_operations[]
  
  @@index([company_id])
  @@index([role])
  @@index([is_active])
  @@index([country])
  @@index([created_by])
  @@unique([company_id, code])
  @@unique([company_id, vat_code])
}

// ... [–û–°–¢–ê–õ–¨–ù–ê–Ø –ß–ê–°–¢–¨ –°–•–ï–ú–´ –ë–£–î–ï–¢ –í –°–õ–ï–î–£–Æ–©–ï–ú –°–û–û–ë–©–ï–ù–ò–ò] ...

// ===============================================
// üìç –ê–î–†–ï–°–ê –ö–õ–ò–ï–ù–¢–û–í
// ===============================================

model client_addresses {
  id                    Int         @id @default(autoincrement())
  client_id             Int
  
  address               String?     @db.VarChar(255)
  city                  String?     @db.VarChar(100)
  country               String      @db.VarChar(100)
  postcode              String?     @db.VarChar(20)
  employee_id           Int?
  
  is_registration       Boolean     @default(false)
  is_correspondence     Boolean     @default(false)
  is_load               Boolean     @default(false)
  is_unload             Boolean     @default(false)
  is_department         Boolean     @default(false)
  
  name                  String?     @db.VarChar(100)
  description           String?     @db.Text
  notes                 String?     @db.Text
  is_active             Boolean     @default(true)
  created_at            DateTime    @default(now())
  updated_at            DateTime    @updatedAt
  
  client                clients     @relation(fields: [client_id], references: [id], onDelete: Cascade)
  employee              users?      @relation("AddressEmployee", fields: [employee_id], references: [id])
  
  @@index([client_id])
  @@index([country])
  @@index([is_correspondence])
}

// ===============================================
// üè¶ –ë–ê–ù–ö–û–í–°–ö–ò–ï –°–ß–ï–¢–ê –ö–õ–ò–ï–ù–¢–û–í
// ===============================================

model client_bank_accounts {
  id                    Int         @id @default(autoincrement())
  client_id             Int
  
  account_number        String      @db.VarChar(50)
  bank_name             String      @db.VarChar(100)
  bank_code             String?     @db.VarChar(20)
  swift_code            String?     @db.VarChar(20)
  iban                  String?     @db.VarChar(50)
  currency              Currency    @default(EUR)
  is_primary            Boolean     @default(false)
  is_active             Boolean     @default(true)
  
  created_at            DateTime    @default(now())
  updated_at            DateTime    @updatedAt
  
  client                clients     @relation(fields: [client_id], references: [id], onDelete: Cascade)
  
  @@index([client_id])
  @@index([is_primary])
  @@unique([client_id, account_number])
}

// ... [–ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –í –°–õ–ï–î–£–Æ–©–ï–ú –ë–õ–û–ö–ï] ...

// ===============================================
// üì¶ –¢–û–í–ê–†–´ –ò –£–°–õ–£–ì–ò
// ===============================================

model products {
  id                    Int         @id @default(autoincrement())
  company_id            Int
  
  code                  String      @db.VarChar(50)
  name                  String      @db.VarChar(255)
  description           String?     @db.Text
  unit                  String      @db.VarChar(20)
  price                 Decimal     @db.Decimal(10, 2)
  cost_price            Decimal?    @db.Decimal(10, 2)
  currency              Currency    @default(EUR)
  vat_rate              Decimal?    @db.Decimal(5, 2)
  category              String?     @db.VarChar(100)
  subcategory           String?     @db.VarChar(100)
  min_stock             Decimal?    @db.Decimal(10, 2)
  current_stock         Decimal?    @db.Decimal(10, 2)
  is_active             Boolean     @default(true)
  is_service            Boolean     @default(false)
  
  created_by            Int
  created_at            DateTime    @default(now())
  updated_at            DateTime    @updatedAt
  
  company               companies   @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator               users       @relation("ProductCreator", fields: [created_by], references: [id])
  sale_items            sale_items[]
  purchase_items        purchase_items[]
  
  @@index([company_id])
  @@index([is_active])
  @@unique([company_id, code])
}

// ===============================================
// üí∞ –ü–†–û–î–ê–ñ–ò
// ===============================================

model sales {
  id                    Int                 @id @default(autoincrement())
  company_id            Int
  
  document_number       String              @db.VarChar(50)
  document_date         DateTime            @db.Date
  document_type         SalesDocumentType   @default(INVOICE)
  delivery_date         DateTime?           @db.Date
  due_date              DateTime?           @db.Date
  
  client_id             Int
  warehouse_id          Int?
  sales_manager_id      Int?
  
  subtotal              Decimal             @db.Decimal(15, 2)
  vat_amount            Decimal             @db.Decimal(15, 2) @default(0)
  discount_amount       Decimal             @db.Decimal(15, 2) @default(0)
  total_amount          Decimal             @db.Decimal(15, 2)
  currency              Currency            @default(EUR)
  
  payment_status        PaymentStatus       @default(PENDING)
  delivery_status       DeliveryStatus      @default(PENDING)
  document_status       DocumentStatus      @default(DRAFT)
  
  created_by            Int
  created_at            DateTime            @default(now())
  updated_by            Int?
  updated_at            DateTime            @updatedAt
  
  company               companies           @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator               users               @relation("SaleCreator", fields: [created_by], references: [id])
  modifier              users?              @relation("SaleModifier", fields: [updated_by], references: [id])
  client                clients             @relation(fields: [client_id], references: [id])
  warehouse             warehouses?         @relation(fields: [warehouse_id], references: [id])
  sales_manager         users?              @relation("SalesManager", fields: [sales_manager_id], references: [id])
  items                 sale_items[]
  
  @@index([company_id])
  @@index([document_date])
  @@index([client_id])
  @@index([payment_status])
  @@unique([company_id, document_number])
}

// ===============================================
// üì¶ –ü–û–ó–ò–¶–ò–ò –ü–†–û–î–ê–ñ
// ===============================================

model sale_items {
  id                    Int         @id @default(autoincrement())
  
  sale_id               Int
  product_id            Int
  line_number           Int?
  quantity              Decimal     @db.Decimal(10, 3)
  unit_price_base       Decimal     @db.Decimal(10, 2)
  
  discount_percent      Decimal?    @db.Decimal(5, 2) @default(0)
  total_discount        Decimal?    @db.Decimal(15, 2) @default(0)
  vat_rate              Decimal?    @db.Decimal(5, 2)
  vat_amount            Decimal?    @db.Decimal(15, 2)
  line_total            Decimal     @db.Decimal(15, 2)
  
  description           String?     @db.Text
  created_at            DateTime    @default(now())
  updated_at            DateTime    @updatedAt
  
  sale                  sales       @relation(fields: [sale_id], references: [id], onDelete: Cascade)
  product               products    @relation(fields: [product_id], references: [id])
  
  @@index([sale_id])
  @@index([product_id])
}

// ===============================================
// üõí –ó–ê–ö–£–ü–ö–ò
// ===============================================

model purchases {
  id                    Int                     @id @default(autoincrement())
  company_id            Int
  
  document_number       String                  @db.VarChar(50)
  document_date         DateTime                @db.Date
  operation_type        PurchaseOperationType   @default(PURCHASE)
  
  supplier_id           Int
  warehouse_id          Int?
  
  subtotal              Decimal                 @db.Decimal(15, 2)
  vat_amount            Decimal                 @db.Decimal(15, 2) @default(0)
  total_amount          Decimal                 @db.Decimal(15, 2)
  currency              Currency                @default(EUR)
  
  payment_status        PaymentStatus           @default(PENDING)
  delivery_status       DeliveryStatus          @default(PENDING)
  document_status       DocumentStatus          @default(DRAFT)
  
  created_by            Int
  created_at            DateTime                @default(now())
  updated_at            DateTime                @updatedAt
  
  company               companies               @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator               users                   @relation("PurchaseCreator", fields: [created_by], references: [id])
  supplier              clients                 @relation(fields: [supplier_id], references: [id])
  warehouse             warehouses?             @relation(fields: [warehouse_id], references: [id])
  items                 purchase_items[]
  
  @@index([company_id])
  @@index([document_date])
  @@index([supplier_id])
  @@unique([company_id, document_number])
}

// ===============================================
// üì¶ –ü–û–ó–ò–¶–ò–ò –ó–ê–ö–£–ü–û–ö
// ===============================================

model purchase_items {
  id                    Int         @id @default(autoincrement())
  
  purchase_id           Int
  product_id            Int
  line_number           Int?
  quantity              Decimal     @db.Decimal(10, 3)
  unit_price            Decimal     @db.Decimal(10, 2)
  vat_rate              Decimal?    @db.Decimal(5, 2)
  vat_amount            Decimal?    @db.Decimal(15, 2)
  line_total            Decimal     @db.Decimal(15, 2)
  
  employee_id           Int?
  notes                 String?     @db.Text
  created_at            DateTime    @default(now())
  updated_at            DateTime    @updatedAt
  
  purchase              purchases   @relation(fields: [purchase_id], references: [id], onDelete: Cascade)
  product               products    @relation(fields: [product_id], references: [id])
  employee              users?      @relation("PurchaseItemEmployee", fields: [employee_id], references: [id])
  
  @@index([purchase_id])
  @@index([product_id])
}

// ===============================================
// üè≠ –°–ö–õ–ê–î–´
// ===============================================

model warehouses {
  id                    Int             @id @default(autoincrement())
  company_id            Int
  
  name                  String          @db.VarChar(100)
  code                  String?         @db.VarChar(20)
  description           String?         @db.Text
  address               String?         @db.Text
  manager_id            Int?
  status                WarehouseStatus @default(ACTIVE)
  is_main               Boolean         @default(false)
  
  created_by            Int
  created_at            DateTime        @default(now())
  updated_at            DateTime        @updatedAt
  
  company               companies       @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator               users           @relation("WarehouseCreator", fields: [created_by], references: [id])
  manager               users?          @relation("WarehouseResponsible", fields: [manager_id], references: [id])
  sales                 sales[]
  purchases             purchases[]
  
  @@index([company_id])
  @@index([status])
  @@unique([company_id, code])
}

// ===============================================
// üè¶ –ë–ê–ù–ö–û–í–°–ö–ò–ï –û–ü–ï–†–ê–¶–ò–ò
// ===============================================

model bank_operations {
  id                    Int                 @id @default(autoincrement())
  company_id            Int
  
  doc_number            String              @db.VarChar(50)
  operation_date        DateTime            @db.Date
  amount                Decimal             @db.Decimal(15, 2)
  currency              Currency            @default(EUR)
  type                  BankOperationType
  description           String              @db.VarChar(255)
  client_id             Int?
  
  created_by            Int
  created_at            DateTime            @default(now())
  updated_at            DateTime            @updatedAt
  
  company               companies           @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator               users               @relation(fields: [created_by], references: [id])
  client                clients?            @relation(fields: [client_id], references: [id])
  
  @@index([company_id])
  @@index([operation_date])
  @@index([type])
}

// ===============================================
// üìä –ü–õ–ê–ù –°–ß–ï–¢–û–í
// ===============================================

model chart_of_accounts {
  id                    Int         @id @default(autoincrement())
  company_id            Int
  
  account_code          String      @db.VarChar(20)
  account_name          String      @db.VarChar(255)
  account_type          String      @db.VarChar(50)
  is_active             Boolean     @default(true)
  currency              Currency?
  
  created_by            Int
  created_at            DateTime    @default(now())
  updated_at            DateTime    @updatedAt
  
  company               companies   @relation(fields: [company_id], references: [id], onDelete: Cascade)
  creator               users       @relation(fields: [created_by], references: [id])
  
  @@index([company_id])
  @@index([account_type])
  @@unique([company_id, account_code])
}

// ===============================================
// üìö –°–ü–†–ê–í–û–ß–ù–ò–ö–ò
// ===============================================

model vat_classifications {
  id                    Int         @id @default(autoincrement())
  company_id            Int
  code                  String      @db.VarChar(20)
  name                  String      @db.VarChar(100)
  vat_rate              Decimal     @db.Decimal(5, 2)
  is_active             Boolean     @default(true)
  
  company               companies   @relation(fields: [company_id], references: [id], onDelete: Cascade)
  
  @@index([company_id])
  @@unique([company_id, code])
}

model cost_centers {
  id                    Int         @id @default(autoincrement())
  company_id            Int
  code                  String      @db.VarChar(20)
  name                  String      @db.VarChar(100)
  parent_id             Int?
  is_active             Boolean     @default(true)
  
  company               companies   @relation(fields: [company_id], references: [id], onDelete: Cascade)
  parent                cost_centers? @relation("CostCenterHierarchy", fields: [parent_id], references: [id])
  children              cost_centers[] @relation("CostCenterHierarchy")
 
 @@index([company_id])
 @@index([parent_id])
 @@unique([company_id, code])
}

model intrastat_codes {
 id                    Int         @id @default(autoincrement())
 code_type             String      @db.VarChar(20)
 code                  String      @db.VarChar(20)
 name                  String      @db.VarChar(200)
 is_active             Boolean     @default(true)
 
 @@index([code_type])
 @@unique([code_type, code])
}