#!/bin/bash

echo "üéäüî•üîç –î–ò–ê–ì–ù–û–°–¢–ò–†–£–ï–ú –¢–û–õ–¨–ö–û BACKEND! üîçüî•üéä"
echo ""
echo "üéØ –¶–ï–õ–¨: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É backend –ø–æ—Å–ª–µ GitHub sync"
echo "‚ö†Ô∏è  FRONTEND –ù–ï –¢–†–û–ì–ê–ï–ú!"
echo ""

echo "1Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú PM2 –°–¢–ê–¢–£–°:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
pm2 status

echo ""
echo "2Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú –õ–û–ì–ò BACKEND:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ 10 —Å—Ç—Ä–æ–∫ –ª–æ–≥–æ–≤ solar-backend:"
pm2 logs solar-backend --lines 10 --nostream

echo ""
echo "3Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú –ü–û–†–¢–´ –ò –°–û–ï–î–ò–ù–ï–ù–ò–Ø:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ç–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 3001 (backend):"
lsof -i :3001 || netstat -tulpn | grep :3001

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—Ç–æ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 5432 (PostgreSQL):"
lsof -i :5432 || netstat -tulpn | grep :5432

echo ""
echo "4Ô∏è‚É£ –¢–ï–°–¢–ò–†–£–ï–ú API –≠–ù–î–ü–û–ò–ù–¢–´:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

echo "üåê –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç:"
curl -s http://localhost:3001/ | head -5 || echo "‚ùå –û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

echo ""
echo "üåê –¢–µ—Å—Ç–∏—Ä—É–µ–º health check:"
curl -s http://localhost:3001/health | head -5 || echo "‚ùå Health check –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

echo ""
echo "üåê –¢–µ—Å—Ç–∏—Ä—É–µ–º API —Å—Ç–∞—Ç—É—Å:"
curl -s http://localhost:3001/api/status | head -5 || echo "‚ùå API —Å—Ç–∞—Ç—É—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

echo ""
echo "5Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú BACKEND –§–ê–ô–õ–´:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

cd b

echo "üìÅ BACKEND –î–ò–†–ï–ö–¢–û–†–ò–Ø: $(pwd)"
echo ""

echo "üìÑ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã backend:"
ls -la | grep -E '\.(js|json|env)$' | head -10

echo ""
echo "üîç package.json backend:"
if [ -f "package.json" ]; then
    echo "‚úÖ package.json –Ω–∞–π–¥–µ–Ω"
    echo "üì¶ –ù–∞–∑–≤–∞–Ω–∏–µ: $(grep '"name"' package.json)"
    echo "üì¶ –í–µ—Ä—Å–∏—è: $(grep '"version"' package.json)"
else
    echo "‚ùå package.json –ù–ï –ù–ê–ô–î–ï–ù!"
fi

echo ""
echo "üîç app.js –∏–ª–∏ main —Ñ–∞–π–ª:"
if [ -f "app.js" ]; then
    echo "‚úÖ app.js –Ω–∞–π–¥–µ–Ω"
elif [ -f "src/app.js" ]; then
    echo "‚úÖ src/app.js –Ω–∞–π–¥–µ–Ω"
elif [ -f "index.js" ]; then
    echo "‚úÖ index.js –Ω–∞–π–¥–µ–Ω"
else
    echo "‚ùå –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "üìÇ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏:"
    ls -la
fi

echo ""
echo "6Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú ENVIRONMENT VARIABLES:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

if [ -f ".env" ]; then
    echo "‚úÖ .env —Ñ–∞–π–ª –Ω–∞–π–¥–µ–Ω"
    echo "üîê Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö):"
    grep -E '^[A-Z_]+=.*' .env | grep -v -E '(PASSWORD|SECRET|KEY)' | head -5
else
    echo "‚ùå .env —Ñ–∞–π–ª –ù–ï –ù–ê–ô–î–ï–ù!"
fi

echo ""
echo "7Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú DATABASE –°–û–ï–î–ò–ù–ï–ù–ò–ï:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

echo "üóÑÔ∏è –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL:"
pg_isready -h localhost -p 5432 || echo "‚ö†Ô∏è PostgreSQL –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"

echo ""
echo "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –±–∞–∑–æ–π (–µ—Å–ª–∏ –µ—Å—Ç—å psql):"
if command -v psql &> /dev/null; then
    echo "‚úÖ psql –¥–æ—Å—Ç—É–ø–µ–Ω"
    # –ü—Ä–æ–±—É–µ–º –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ
    psql -h localhost -p 5432 -U solar_user -d solar -c "SELECT version();" 2>/dev/null | head -3 || echo "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ"
else
    echo "‚ö†Ô∏è psql –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
fi

echo ""
echo "8Ô∏è‚É£ –ü–†–û–í–ï–†–Ø–ï–ú –°–ò–°–¢–ï–ú–ù–´–ï –†–ï–°–£–†–°–´:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

echo "üíæ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:"
free -h | head -2

echo ""
echo "üíΩ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞:"
df -h | head -3

echo ""
echo "‚ö° Load average:"
uptime

echo ""
echo "9Ô∏è‚É£ –§–ò–ù–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

echo "üîç –ü–æ—Å–ª–µ–¥–Ω–∏–µ error –ª–æ–≥–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å):"
pm2 logs solar-backend --err --lines 5 --nostream 2>/dev/null || echo "–ù–µ—Ç error –ª–æ–≥–æ–≤"

echo ""
echo "üéØ –°–¢–ê–¢–£–° BACKEND –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò:"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ backend –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç
if curl -s http://localhost:3001/ > /dev/null; then
    echo "‚úÖ BACKEND –†–ê–ë–û–¢–ê–ï–¢ - –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã"
else
    echo "‚ùå BACKEND –ù–ï –û–¢–í–ï–ß–ê–ï–¢ - —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º PM2 –ø—Ä–æ—Ü–µ—Å—Å
if pm2 list | grep -q "online.*solar-backend"; then
    echo "‚úÖ PM2 –ü–†–û–¶–ï–°–° –ê–ö–¢–ò–í–ï–ù"
else
    echo "‚ùå PM2 –ü–†–û–¶–ï–°–° –ü–†–û–ë–õ–ï–ú–ù–´–ô"
fi

echo ""
echo "üéä –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê BACKEND –ó–ê–í–ï–†–®–ï–ù–ê!"
echo ""
echo "üí° –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò:"
echo "1Ô∏è‚É£ –ü–æ–∫–∞–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏"
echo "2Ô∏è‚É£ –ò—Å–ø—Ä–∞–≤–ª—é –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã"
echo "3Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º backend –µ—Å–ª–∏ –Ω—É–∂–Ω–æ"
echo "4Ô∏è‚É£ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–µ–º API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã"
echo ""
echo "‚ö†Ô∏è  FRONTEND –û–°–¢–ê–Å–¢–°–Ø –ù–ï–¢–†–û–ù–£–¢–´–ú!"